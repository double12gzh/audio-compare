# TTS 音频验收工具

一个基于 Streamlit 的 TTS 音频验收工具，支持音频波形分析、Mel 频谱图生成、音频对比分析等功能。

## 功能特性

### 🎵 单音频分析
- 音频波形图可视化
- Mel 频谱图生成
- MFCC 特征提取
- 音频特征统计（时长、RMS、零交叉率、频谱质心等）

### 🔄 音频对比分析
- 波形叠加对比图
- Mel 频谱对比图
- 相似度计算（相关系数、均方误差、信噪比）

### 📈 批量分析
- 多文件批量处理
- 特征数据表格导出
- CSV 格式结果下载

## 安装依赖

1. 确保已安装 Python 3.8+
2. 安装依赖包：

```bash
pip install -r requirements.txt
```

## 运行应用

```bash
streamlit run app.py
```

应用将在浏览器中自动打开，默认地址为 `http://localhost:8501`

## 使用说明

### 单音频分析
1. 在"单音频分析"标签页中上传音频文件
2. 查看音频基本信息和特征统计
3. 分析音频波形图和 Mel 频谱图
4. 查看 MFCC 特征系数

### 音频对比分析
1. 在"音频对比"标签页中上传两个音频文件
2. 查看相似度分析结果
3. 对比波形图和 Mel 频谱图
4. 分析音频差异

### 批量分析
1. 在"批量分析"标签页中上传多个音频文件
2. 查看批量分析结果表格
3. 下载 CSV 格式的分析报告

## 支持的音频格式

- WAV
- MP3
- FLAC

## 技术栈

- **Streamlit**: Web 应用框架
- **Librosa**: 音频处理库
- **Plotly**: 交互式图表
- **NumPy**: 数值计算
- **Pandas**: 数据处理
- **SciPy**: 科学计算

## 配置文件

应用支持通过YAML配置文件进行参数配置。配置文件包含以下主要部分：

### 音频处理配置
- **采样率**: 默认22050Hz
- **FFT窗口大小**: 默认2048
- **Mel滤波器组数量**: 默认128
- **MFCC系数数量**: 默认13

### 服务器配置
- **端口**: 默认8501
- **主机**: 默认localhost
- **CORS支持**: 默认启用
- **XSRF保护**: 默认启用

### 文件处理配置
- **支持格式**: wav, mp3, flac, ogg, m4a
- **最大文件大小**: 默认100MB
- **最大批量文件数**: 默认50

### 配置管理

使用配置管理工具：

```bash
# 生成默认配置文件
python config_manager.py generate

# 验证配置文件
python config_manager.py validate config.yaml

# 显示配置差异
python config_manager.py diff config.yaml

# 备份配置文件
python config_manager.py backup config.yaml
```

### 配置文件示例

```yaml
# 音频处理配置
audio:
  default_sample_rate: 22050
  n_fft: 2048
  n_mels: 128
  n_mfcc: 13

# 服务器配置
app:
  server:
    port: 8501
    host: "localhost"
  debug_mode: false
  log_level: "INFO"
```

## 配置参数

在侧边栏中可以调整以下参数：

- **采样率**: 8000Hz, 16000Hz, 22050Hz, 44100Hz
- **Mel 滤波器组数量**: 64-256

## 音频特征说明

### 基本特征
- **时长**: 音频持续时间
- **RMS**: 均方根值，表示音频能量
- **零交叉率**: 音频信号穿过零轴的频率

### 频谱特征
- **频谱质心**: 频谱的"重心"频率
- **频谱带宽**: 频谱的宽度
- **频谱滚降**: 累积频谱能量达到85%的频率

### MFCC 特征
- 梅尔频率倒谱系数，用于语音识别和音频分类

## 相似度指标

### 相关系数
- 范围：-1 到 1
- 1 表示完全正相关，-1 表示完全负相关，0 表示无相关

### 均方误差 (MSE)
- 两个音频信号差异的平方平均值
- 值越小表示越相似

### 信噪比 (SNR)
- 信号功率与噪声功率的比值
- 值越大表示音频质量越好

## 注意事项

1. 大文件处理可能需要较长时间
2. 建议使用 WAV 格式获得最佳分析效果
3. 确保音频文件没有损坏
4. 批量分析时建议文件数量不超过 50 个

## 开发说明

### 模块说明

- **core**: 核心业务逻辑，包含音频分析和特征提取
- **visualization**: 图表绘制功能，使用 Plotly 生成交互式图表
- **ui**: 用户界面组件，包括页面和可复用组件
- **utils**: 工具类，包括配置管理和异常处理
